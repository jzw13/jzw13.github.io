<html>
<head>
	<meta charset="UTF-8">
	<title>生命游戏2015</title>
    <link href="src/bootstrap.min.css" rel="stylesheet" media="screen">
</head>

<style>
	body{
		background-color: #EEEEEE;
	}
	.banner{
	position:fixed;
	z-index:99999;
	width:100%;
	margin: 0 auto;
	text-align:center;
	background: rgba(42,88,255,0.8);
	box-shadow:0 1px 1px rgba(34,25,25,0.1);
	color:#FFFFFF;
	font-size:36px;
	font-family: "Arial";
	font-style: bold;
	}
	.container{
		width:100%;
	}
	.status{
		width:40%;
		right:5%;
		top:100px;
		position:absolute;
	}
	#myCanvas{
		margin-top:60px;
		margin-left:15%;
	}
	#right-container{
		position:fixed;
		right:10px;
		top:180px;
		width:40%;
	}
	.livecells{
		font-size: 36px;
		font-style: bold;
		color:#FF0000;
		left:10%;
	}
</style>

<body>	
	<div class="banner">生命游戏2015</div>
	<div class="container">
	<canvas id="myCanvas" height="500" width="500"></canvas>
	<div id="right-container">
		当前生存细胞数：
		<div class="livecells">0</div>
		<button class="btn btn-lg btn-primary" style="margin-left:2%"  onclick="initializeMap(70, 70, 0.5)">随机生成细胞
    	</button>
    	<button class="btn btn-lg btn-success" style="margin-left:2%"  onclick="continueGrow()">启动
    	</button>
    	<button class="btn btn-lg btn-" style="margin-left:2%"  onclick="pauseGrow()">暂停
    	</button>
     	<button class="btn btn-lg btn-danger" style="margin-left:2%"  onclick="reset()">重设
    	</button>
		</div>
	</div>
	</div>
	<script type="text/javascript">
	var lives = 0;
	var scale = 7;
	var width, height;
	var map = new Array(300);
	var tempMap = new Array(300);
	var rate = 0.5;
	var flag = 1;
	for (i = 0; i < 300; i++) {
		map[i] = new Array(300);
		tempMap[i] = new Array(300);
	}
	var canvas=document.getElementById('myCanvas');
	var ctx=canvas.getContext('2d');
	ctx.fillStyle=("#000")
	function redraw(){
		lives = 0;
		ctx.clearRect(0, 0, width * scale,height * scale);
		for(i = 0; i < width; i++){
			for (j = 0; j < height; j++){
				lives += map[i][j];
				if(map[i][j] == 1){
					ctx.fillRect(i * scale, j * scale, scale, scale);
				}else{
					ctx.strokeRect(i * scale, j * scale, scale, scale);
				}
			}
		}
	}
	function refresh() {
		redraw();
		if(flag == 1)
			grow();
		setTimeout("refresh()", 100);
		$(".livecells")[0].innerHTML= String(lives);
	}
	function getNeighbour(i, j){
		var num = 0;
		var tX, tY;
		for(x = i - 1; x <= i + 1; x++){
			for(y = j - 1; y <= j + 1; y++){
				tX = x;
				tY = y;
				if(tX < 0)
					tX += width;
				if(tY < 0)
					tY += height;
				if(tX >= width)
					tX -= width;
				if(tY >= height)
					tY -= height;
				num += map[tX][tY];
			}
		}
		num -= map[i][j];
		return num;
	}
	function grow(){
		for(i = 0; i < width; i++){
			for(j = 0; j < height; j++){
				tempMap[i][j] = map[i][j];
			if(getNeighbour(i, j) == 3)
				tempMap[i][j] = 1;
			else if(getNeighbour(i, j) != 2)
				tempMap[i][j] = 0;
			}
		}
		for(i = 0; i < width; i++){
			for(j = 0; j < height; j++){
				map[i][j] = tempMap[i][j];
			}
		}
	}
	function reset(){
		for(i = 0 ; i < width ; i++)
			for(j = 0 ; j < height ; j++){
				map[i][j] = 0;
		}
		flag = 0;
		redraw();
	}
	function drawMap(x, y){
		width = x;
		height = y;
		for(i = 0; i < width; i++)
			for(j = 0; j < height; j++)
				ctx.strokeRect(i * scale, j * scale, scale, scale);
	}
	function initializeMap(x, y, r) {
		flag = 1;
		width = x;
		height = y;
		rate = r;
		for (i = 0; i < width; i++)
			for (j = 0; j < height; j++)
				if (Math.random() > rate)
					map[i][j] = 1;
				else map[i][j] = 0;
		redraw();
	}
	drawMap(70, 70);
	function continueGrow(){
		if(flag == 0){
			flag = 1;
			redraw();
		}
	}
	function pauseGrow(){
		flag = 0;
	}
	function getPointOnCanvas(canvas, x, y) {
    	var canvasRect =canvas.getBoundingClientRect();
    	return {x:x - canvasRect.left * (canvas.width / canvasRect.width),
            y:y - canvasRect.top * (canvas.height / canvasRect.height)};
	}
	canvas.onmousedown = function(e){
		var mouse = getPointOnCanvas(canvas, e.pageX, e.pageY);
		var x, y;
		x = parseInt(mouse.x / scale);
		y = parseInt(mouse.y / scale);
		map[x][y] = !map[x][y];
		redraw();
	}
	refresh();
	</script>
	<script src="src/jquery.js"></script>
</body>
</html>